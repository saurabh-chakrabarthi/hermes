version: '3.8'

services:
  payment-server:
    image: ghcr.io/${GITHUB_REPOSITORY_OWNER}/hermes-payment-server:latest
    container_name: payment-server
    ports:
      - "9292:9292"
    environment:
      - PORT=9292
      - NODE_ENV=production
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:9292/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  payment-dashboard:
    image: ghcr.io/${GITHUB_REPOSITORY_OWNER}/hermes-payment-dashboard:latest
    container_name: payment-dashboard
    ports:
      - "8080:8080"
    environment:
      - PAYMENT_SERVER_URL=http://payment-server:9292
    depends_on:
      - payment-server
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8080/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 3
